Analyzing Election Contributions in West Virginia by Michael Kuehn
========================================================

```{r echo=FALSE, message=FALSE, warning=FALSE, packages}
# Load all of the packages that you end up using
# in your analysis in this code chunk.

# Notice that the parameter "echo" was set to FALSE for this code chunk.
# This prevents the code from displaying in the knitted HTML output.
# You should set echo=FALSE for all code chunks in your file.
setwd("F:/Dropbox/Courses/00 Nanodegree -- Data Analyst/P4 Explore and Summarize Data/P4-Explore-and-Summarize-Data")
library(ggplot2)
library(pastecs)
# Load the Data
dirty_election08_df <- read.csv('2008election_wv.csv', header = T)
election08_df <- read.csv('clean2008election_wv.csv', header = T)
```

Prior to conducting an analysis using R, the data was reviewed and audited in Python.  Please see [Python code](Clean and Audit Election CSVs.py).  I noticed that there were a wide range of occupations that people had inputted while making their contributions.  In order to have a more meaningful analysis regarding contributor's occupations, I classified occupations into general categories (e.g. MEDICAL, EDUCATION, RETIRED, etc.).  The original data was read into a Python script and a new csv file was output with occupation categories.  Any contributions that were negative numbers were skipped since these are refunds.  The focus is on contributions made to judge the excitement and engagment of individual donors during the election cycle.

The first stage of the analysis is to look at a summary of the data.  Most of the columns in the data are categorical variables.  Tables were created for each of these variables to examine the counts and relative frequencies within the data.  The contribution amount is a quantitative varible and will be analyzed using measures of center and spread.

The following columns will be explored in this analysis: 'cand_nm','contbr_city', 'contbr_employer', 'contbr_occupation', 'occupation_category', 'contb_receipt_amt', 'contb_receipt_dt', and 'election_tp'

The code block below includes the structure of the data, a summary of the data, and two sets of tables.  The first table lists the top 10 (if there are 10 categories) counts for each of the columns.  The second table lists the same information but as percentages.  A table of some detailed summary statistics for the quantitative variable 'contb_receipt_amt' is also included.

```{r echo=FALSE, Univariate_Data_Analysis}
str(election08_df)
summary(election08_df)
columns_to_analyze <- c('cand_nm','contbr_city', 'contbr_employer', 'contbr_occupation', 'occupation_category',
                        'contb_receipt_dt', 'election_tp')
lapply(election08_df[columns_to_analyze], function(x) sort(table(x), decreasing = TRUE)[1:10])
lapply(election08_df[columns_to_analyze], function(x) sort(table(x), decreasing = TRUE)[1:10] / nrow(election08_df) * 100)

options(scipen=100)
options(digits=2)
stat.desc(election08_df$contb_receipt_amt)
```
# Univariate Plots Section
```{r echo=FALSE, Univariate_Plots}
columns_to_plot <- c('cand_nm', 'occupation_category', 'election_tp')

quick_plots <- function(x) {
  ggplot(aes(x = x, fill = x), data = election08_df) +
    geom_bar() +
    theme(axis.text.x = element_text(angle = 90, hjust = 1))
}

lapply(election08_df[columns_to_plot], quick_plots)

#quick_plots(cand_nm, election08_df)



# 'contbr_city'
ggplot(aes(x = contbr_city, fill = contbr_city), data = election08_df) +
  geom_bar() +
  theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
  scale_x_discrete(limits = names(sort(table(election08_df$contbr_city), decreasing=TRUE))[1:10])



# 'contbr_employer'
ggplot(aes(x = contbr_employer, fill = contbr_employer), data = election08_df) +
  geom_bar() +
  theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
  scale_x_discrete(limits = names(sort(table(election08_df$contbr_employer), decreasing=TRUE))[1:10])

# 'contbr_occupation'
ggplot(aes(x = contbr_occupation, fill = contbr_occupation), data = election08_df) +
  geom_bar() +
  theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
  scale_x_discrete(limits = names(sort(table(election08_df$contbr_occupation), decreasing=TRUE))[1:10])

# 'contb_receipt_amt'
ggplot(aes(x = contb_receipt_amt), data = election08_df) +
  geom_histogram(binwidth = sqrt(nrow(election08_df)))


ggplot(aes(x = '.', y = contb_receipt_amt), data = election08_df) +
  geom_boxplot() +
  coord_flip()

# 'contb_receipt_dt'
ggplot(aes(x = contb_receipt_dt, fill = contb_receipt_dt), data = election08_df) +
  geom_bar() +
  theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
  scale_x_discrete(limits = names(sort(table(election08_df$contb_receipt_dt), decreasing=TRUE))[1:10])


```

# Univariate Analysis

### What is the structure of your dataset?
The cleaned data includes information on 9109 individual contributions.  There are 19 columns which are described [here](election_wv.txt).  

### What is/are the main feature(s) of interest in your dataset?
The main features of interest are the candidates, contributor occupations, contributor cities, contribution amounts, and contribution dates.  

### What other features in the dataset do you think will help support your investigation into your feature(s) of interest?
Of the 17 candidates who received contributions in this data, only a handful are probably worth investigating.  For example, there are only 3 candidates (Obama, McCain, and Clinton) who received over 10% of the total number of contributions. Only 5 other candidates received more than 1% of the total number of contributions.  This could be an argument to only focus on the data for Obama, McCain, and Clinton.  Another case for focusing on the main candidates would be that many of the other candidates dropped out early in the primary cycle.  Edwards, Romney, and Huckabee dropped out in January, February, and March 2008, respectively (<a href="https://en.wikipedia.org/wiki/Democratic_Party_presidential_primaries,_2008#Candidates_and_results" target="new">Democratic Primary</a> & <a href="https://en.wikipedia.org/wiki/Republican_Party_presidential_primaries,_2008#Candidates" target="new">Republican Primary</a>).  Republicans Brownback, Gilmore, and Tancredo who appear in the data withdrew before the primaries (<a href="https://en.wikipedia.org/wiki/Republican_Party_presidential_primaries,_2008#Withdrew_before_primaries" target="new">Withdrew before primaries</a>).  Other candidates in the data set have such a small amount of contributions to justify looking at the main candidates of Clinton, McCain, and Obama in later sections.

### Did you create any new variables from existing variables in the dataset?
Yes, during the cleaning and processing of the file, I decided to place the occupations into different bins.  There were too many variations of different occupations, and I wanted to be able to do some analysis on occupation and its effect on contributions.

### Of the features you investigated, were there any unusual distributions? Did you perform any operations on the data to tidy, adjust, or change the form of the data? If so, why did you do this?



# Bivariate Plots Section
```{r echo=FALSE, Bivariate_Plots}
subset_by_cand_nm <- subset(election08_df, cand_nm %in% names(sort(table(election08_df$cand_nm), decreasing=TRUE))[1:3])

# "Main" Candidates > 10% of the contributions in the data set
subset_by_main_cand <- subset(election08_df, cand_nm %in% c("Clinton, Hillary Rodham","Obama, Barack","McCain, John S"))
ggplot(aes(x = contbr_city, fill = cand_nm), data = election08_df) +
  geom_bar() +
  theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
  scale_x_discrete(limits = names(sort(table(election08_df$contbr_city), decreasing=TRUE))[1:10])

ggplot(aes(x = contbr_city, fill = cand_nm), data = subset_by_main_cand) +
  geom_bar(aes(y = (..count..)/sum(..count..))) +
  theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
  scale_x_discrete(limits = names(sort(table(subset_by_main_cand$contbr_city), decreasing=TRUE))[1:10])

ggplot(aes(x = occupation_category, fill = cand_nm), data = subset_by_main_cand) +
    geom_bar(aes(y = (..count..)/sum(..count..))) +
    theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
  scale_x_discrete(limits = names(sort(table(election08_df$occupation_category), decreasing=TRUE)))

boxplots <- function(x) {
  ggplot(aes(x = x, y = contb_receipt_amt), data = election08_df) +
  geom_boxplot() +
  coord_flip()
}

lapply(election08_df[columns_to_plot], boxplots)

# ggplot(aes(x = occupation_category, y = contb_receipt_amt), data = election08_df) +
#   geom_boxplot() +
#   coord_flip()

ggplot(data = election08_df, aes(x = occupation_category, y = cand_nm)) +
  geom_bin2d() +
  theme(axis.text.x = element_text(angle = 90, hjust = 1))

ggplot(data = subset_by_cand_nm, aes(x = occupation_category, y = cand_nm)) +
  geom_bin2d() +
  theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
  scale_fill_gradientn(limits = c(0,2000), breaks = seq(0, 1500, by = 500), colors = c('blue','red'))

#with(subset_by_cand_nm, table(occupation_category, cand_nm))


ggplot(data = election08_df, aes(x = contbr_city, y = cand_nm)) +
  geom_bin2d() +
  theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
  scale_x_discrete(limits = names(sort(table(election08_df$contbr_city), decreasing=TRUE))[1:10])

```

# Bivariate Analysis

### Talk about some of the relationships you observed in this part of the investigation. How did the feature(s) of interest vary with other features in the dataset?

### Did you observe any interesting relationships between the other features (not the main feature(s) of interest)?

### What was the strongest relationship you found?




# Multivariate Plots Section

```{r echo=FALSE, Multivariate_Plots}


ggplot(subset_by_cand_nm, aes(x = occupation_category, y = contb_receipt_amt)) +
  geom_boxplot() +
  facet_wrap(~ cand_nm) +
  theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
  coord_flip() +
  scale_y_log10()

ggplot(subset_by_cand_nm, aes(x = contbr_city, y = contb_receipt_amt)) +
  geom_boxplot() +
  facet_wrap(~ cand_nm) +
  theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
  scale_x_discrete(limits = names(sort(table(election08_df$contbr_city), decreasing=TRUE))[1:5]) +
  coord_flip() +
  scale_y_log10()

ggplot(subset_by_cand_nm, aes(x = contb_receipt_dt, y = contb_receipt_amt)) +
  geom_boxplot() +
  facet_wrap(~ cand_nm) +
  theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
  scale_x_discrete(limits = names(sort(table(subset_by_cand_nm$contb_receipt_dt), decreasing=TRUE))[1:5]) +
  coord_flip() +
  scale_y_log10()

test_sub <- subset(election08_df, cand_nm == 'Edwards, John')
ggplot(test_sub, aes(x = contb_receipt_dt, y = contb_receipt_amt)) +
  geom_boxplot() +
  scale_x_discrete(limits = names(sort(table(test_sub$contb_receipt_dt), decreasing=TRUE))[1:15]) +
  coord_cartesian(ylim = c(0, 250)) +
  theme(axis.text.x = element_text(angle = 90, hjust = 1))
  

```

# Multivariate Analysis

### Talk about some of the relationships you observed in this part of the investigation. Were there features that strengthened each other in terms of looking at your feature(s) of interest?

### Were there any interesting or surprising interactions between features?

### OPTIONAL: Did you create any models with your dataset? Discuss the strengths and limitations of your model.

------

# Final Plots and Summary

### Plot One
```{r echo=FALSE, Plot_One}
ggplot(aes(x = cand_nm, fill = cand_nm), data = election08_df) +
  geom_bar() +
  theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
  xlab('Candidate') +
  ylab('Number of Contributions') +
  ggtitle('Contributions Sorted by Candidate') +
  scale_fill_discrete(name = "Candidate Name", breaks = levels(election08_df$cand_nm)) +
  scale_x_discrete(limits = names(sort(table(election08_df$cand_nm), decreasing=TRUE))[1:8])

# ggplot(aes(x = cand_nm, fill = cand_nm), data = election08_df) +
#   geom_bar() +
#   theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
#   xlab('Candidate') +
#   ylab('Number of Contributions') +
#   ggtitle('Contributions Sorted by Candidate') +
#   scale_fill_discrete(name = "Candidate Name", breaks = levels(election08_df$cand_nm)) +
#   scale_x_discrete(limits = names(sort(table(election08_df$cand_nm), decreasing=TRUE)))

ggplot(aes(x = occupation_category, fill = occupation_category), data = election08_df) +
  geom_bar() +
  theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
  xlab('Occupation Category') +
  ylab('Count') +
  ggtitle('Occupations Sorted by Category') +
  scale_fill_discrete(name = "Occupation Category", breaks = levels(election08_df$occupation_category)) +
  scale_x_discrete(limits = names(sort(table(election08_df$occupation_category), decreasing=TRUE)))

```

### Description One


### Plot Two
```{r echo=FALSE, Plot_Two}

```

### Description Two


### Plot Three
```{r echo=FALSE, Plot_Three}

```

### Description Three

------

# Reflection
